{
  "controlId": "03.03.08",
  "controlTitle": "Protection of Audit Information",
  "controlFamily": "AU",
  "settings": [
    {
      "id": "AZ-AU-015",
      "settingName": "AuditLogRBACRoles",
      "displayName": "Audit Log Access - RBAC Role Assignment",
      "settingPath": "AzureAD.RoleAssignments.AuditLogs",
      "policyType": "AzureAD",
      "policySubType": "RoleBasedAccessControl",
      "platform": "All",
      "dataType": "array",
      "expectedValue": ["Reports Reader", "Security Reader", "Security Administrator"],
      "validationOperator": "in",
      "description": "Restricts access to Azure AD audit logs to users with specific privileged roles (Reports Reader, Security Reader, Security Administrator, or Global Administrator). This prevents unauthorized access to sensitive audit information and limits audit log viewing to authorized security personnel only.",
      "implementationGuide": "1. Navigate to Microsoft Entra admin center > Roles and administrators\n2. Review current role assignments for audit-related roles:\n   - Reports Reader (microsoft.directory/auditLogs/allProperties/read)\n   - Security Reader (can read security info and reports)\n   - Security Administrator (can read security info and manage security settings)\n3. Assign roles using least privilege principle:\n   a) For audit log viewing only: Reports Reader\n   b) For security monitoring: Security Reader\n   c) For security operations: Security Administrator\n4. Remove unnecessary Global Administrator assignments\n5. Document role assignments in access control matrix\n6. Review assignments quarterly:\n   Get-MgDirectoryRoleMember -DirectoryRoleId (Get-MgDirectoryRole -Filter \"DisplayName eq 'Reports Reader'\").Id\n7. Enable PIM (Privileged Identity Management) for just-in-time access to these roles\n8. Configure access reviews for privileged role assignments\n9. Monitor audit log for role assignment changes (Category: RoleManagement)",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Role-based access control for audit logs implements the principle of least privilege, ensuring only authorized personnel (security administrators, compliance officers, auditors) can view audit information. This protects audit data from unauthorized access while enabling legitimate security operations.",
          "nistRequirement": "Protect audit information and audit logging tools from unauthorized access, modification, and deletion"
        }
      ]
    },
    {
      "id": "AZ-AU-016",
      "settingName": "AuditLogManagementRestriction",
      "displayName": "Restrict Audit Log Management to Privileged Subset",
      "settingPath": "AzureAD.RoleAssignments.AuditManagement",
      "policyType": "AzureAD",
      "policySubType": "RoleBasedAccessControl",
      "platform": "All",
      "dataType": "array",
      "expectedValue": ["Compliance Administrator", "Security Administrator"],
      "validationOperator": "in",
      "description": "Limits management of audit logging functionality (enabling/disabling audit logging, configuring retention, managing diagnostic settings) to a restricted subset of privileged users. Only Compliance Administrators and Security Administrators should have permissions to modify audit configurations.",
      "implementationGuide": "1. Navigate to Entra admin center > Roles and administrators\n2. Identify roles with audit management permissions:\n   - Compliance Administrator: Can manage audit settings in Purview\n   - Security Administrator: Can configure diagnostic settings\n   - Global Administrator: Has full access (should be limited)\n3. Review current assignments:\n   Get-MgDirectoryRoleMember -DirectoryRoleId (Get-MgDirectoryRole -Filter \"DisplayName eq 'Compliance Administrator'\").Id\n4. Implement least privilege:\n   - Assign Compliance Administrator only to personnel responsible for compliance\n   - Limit Security Administrator to security operations team\n   - Reduce Global Administrator count to minimum (2-3 break-glass accounts)\n5. Create custom roles if needed for more granular control\n6. Enable Privileged Identity Management (PIM):\n   - Configure eligible assignments instead of permanent\n   - Require justification and approval for role activation\n   - Set maximum activation duration (e.g., 8 hours)\n7. Configure alert for audit configuration changes:\n   - Monitor for 'Set-AdminAuditLogConfig' operations\n   - Alert on diagnostic setting modifications\n8. Document all audit management role holders",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-configure",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Restricting audit management capabilities to a minimal subset of privileged users prevents unauthorized disabling of audit logging, tampering with audit configurations, or reducing audit retention. This directly satisfies the requirement to authorize access to management of audit logging functionality to only privileged users.",
          "nistRequirement": "Authorize access to management of audit logging functionality to only a subset of privileged users or roles"
        }
      ]
    },
    {
      "id": "DF-AU-017",
      "settingName": "LogAnalyticsWorkspaceRBAC",
      "displayName": "Log Analytics Workspace Access Control",
      "settingPath": "LogAnalytics.Workspace.AccessControl",
      "policyType": "Defender",
      "policySubType": "WorkspaceRBAC",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {"accessMode": "Resource", "minRole": "Reader"},
      "validationOperator": "==",
      "description": "Implements Azure RBAC on Log Analytics workspace containing audit logs to control who can read, query, or manage audit data. Resource-level permissions ensure users can only access audit logs they're authorized to view, protecting audit information from unauthorized access.",
      "implementationGuide": "1. Navigate to Azure Portal > Log Analytics workspace > Access control (IAM)\n2. Review current role assignments:\n   - Owner: Full control (limit to 2-3 workspace administrators)\n   - Contributor: Can manage all resources except permissions\n   - Log Analytics Reader: Read-only access to logs (assign to SOC analysts)\n   - Log Analytics Contributor: Can manage workspace but not grant access\n3. Configure resource-level permissions:\n   - Settings > Workspace configuration > Access control mode\n   - Select 'Use resource or workspace permissions' (recommended)\n4. Assign roles based on job function:\n   - Security analysts: Log Analytics Reader\n   - Security engineers: Log Analytics Contributor  \n   - Compliance officers: Reader (for reporting only)\n5. Remove unnecessary Owner and Contributor assignments\n6. Configure Azure AD group-based access:\n   - Create 'Security Operations - Audit Readers' Azure AD group\n   - Assign Log Analytics Reader role to group\n   - Manage access via group membership\n7. Enable activity logging for workspace:\n   - Diagnostic settings > Add diagnostic setting\n   - Select 'Audit' log category\n   - Send to separate workspace to prevent tampering\n8. Monitor access: Review 'Activity log' for permission changes",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/azure/azure-monitor/logs/manage-access",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Azure RBAC on Log Analytics workspace provides granular access control for audit logs, ensuring only authorized security personnel can view audit information. Read-only roles prevent unauthorized modification or deletion of audit data, while limiting management access protects audit tool configuration.",
          "nistRequirement": "Protect audit information and audit logging tools from unauthorized access, modification, and deletion"
        }
      ]
    },
    {
      "id": "PV-AU-018",
      "settingName": "AuditRetentionImmutability",
      "displayName": "Immutable Audit Log Retention",
      "settingPath": "Purview.AuditRetention.Immutability",
      "policyType": "Purview",
      "policySubType": "AuditRetention",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Microsoft 365 audit logs are immutable by design - once logged, entries cannot be modified or deleted by users, including Global Administrators. Audit records are retained according to retention policies and automatically deleted only when retention period expires, protecting audit integrity.",
      "implementationGuide": "1. This is a built-in Microsoft 365 capability - audit logs are immutable by default\n2. Verify audit log immutability:\n   - Users cannot modify or delete individual audit log entries\n   - Only retention policies can remove logs after expiration\n   - Even Global Administrators cannot alter audit records\n3. Configure audit retention policies to meet compliance requirements:\n   - Navigate to Purview > Audit > Retention policies\n   - Default: 180 days (Standard), 365 days (E5 users)\n   - Create custom policies for extended retention (up to 10 years)\n4. Export audit logs for long-term archival if needed:\n   - Regular exports to Azure Storage (immutable blob storage)\n   - Enable write-once-read-many (WORM) policy on storage\n5. Configure alert for retention policy changes:\n   - Monitor AuditLogs for 'New-UnifiedAuditLogRetentionPolicy' operations\n   - Alert on 'Set-UnifiedAuditLogRetentionPolicy' modifications\n6. Document retention policies and legal hold requirements\n7. For extended protection, export to Azure Storage with legal hold:\n   - Create dedicated storage account for audit archives\n   - Enable version-level immutability with time-based retention",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/purview/audit-log-retention-policies",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Immutability of audit logs prevents unauthorized modification or deletion of audit records, ensuring audit trail integrity for investigations and compliance. Combined with retention policies, this protects audit information throughout its lifecycle from creation to authorized disposal.",
          "nistRequirement": "Protect audit information from unauthorized access, modification, and deletion"
        }
      ]
    },
    {
      "id": "AZ-AU-019",
      "settingName": "DiagnosticSettingsProtection",
      "displayName": "Protect Diagnostic Settings from Unauthorized Changes",
      "settingPath": "AzureAD.DiagnosticSettings.RoleAssignment",
      "policyType": "AzureAD",
      "policySubType": "RoleBasedAccessControl",
      "platform": "All",
      "dataType": "string",
      "expectedValue": "Security Administrator",
      "validationOperator": "==",
      "description": "Restricts modification of Azure AD diagnostic settings (which control audit log export to SIEM/Log Analytics) to Security Administrators only. Prevents attackers or insiders from disabling audit log export to evade detection. Monitors and alerts on any diagnostic setting changes.",
      "implementationGuide": "1. Verify diagnostic settings permissions:\n   - Navigate to Entra admin center > Diagnostic settings\n   - Only users with these roles can modify settings:\n     * Security Administrator\n     * Global Administrator\n2. Review and limit role assignments:\n   - Minimize Global Administrators (2-3 maximum)\n   - Assign Security Administrator only to security operations leads\n   - Use PIM for just-in-time access\n3. Enable audit logging for diagnostic setting changes:\n   - Changes are logged in Azure Activity Log\n   - Category: 'microsoft.aadiam'\n   - Operation: 'Microsoft.Insights/DiagnosticSettings/Write'\n4. Create alert rule for diagnostic setting changes:\n   - Navigate to Azure Monitor > Alerts > Create alert rule\n   - Scope: All resources in subscription\n   - Condition: Activity Log - Administrative\n   - Operation name: 'Create or Update Diagnostic Setting'\n   - Create action group to notify security team\n5. Implement secondary monitoring:\n   - Use Microsoft Sentinel analytic rule\n   - Query: AzureActivity | where OperationNameValue == 'MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/WRITE'\n6. Configure Azure Policy to enforce diagnostic settings:\n   - Policy: 'Deploy Diagnostic Settings for Azure AD to Log Analytics workspace'\n   - Assignment: Tenant root or management group level\n7. Document approved diagnostic setting changes in change log",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/howto-configure-diagnostic-settings",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Protecting diagnostic settings prevents adversaries from disabling audit log export to SIEM, which would hide their activities from detection. This safeguards the audit logging tools configuration and ensures continuous audit data collection for security monitoring and incident response.",
          "nistRequirement": "Protect audit logging tools from unauthorized access, modification, and deletion. Authorize access to management of audit logging functionality to only a subset of privileged users."
        }
      ]
    },
    {
      "id": "AZ-AU-020",
      "settingName": "ConditionalAccessAuditProtection",
      "displayName": "Conditional Access Policy for Audit Tool Access",
      "settingPath": "AzureAD.ConditionalAccess.AuditAccess",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {"requireMFA": true, "requireCompliantDevice": true, "blockLegacyAuth": true},
      "validationOperator": "==",
      "description": "Implements Conditional Access policy requiring MFA and compliant devices when accessing audit logs, Purview compliance portal, Azure Monitor, or Sentinel. This adds an additional layer of protection for audit information and prevents unauthorized access even with compromised credentials.",
      "implementationGuide": "1. Navigate to Entra admin center > Protection > Conditional Access\n2. Create new policy: 'Audit Tool Access Protection'\n3. Configure Assignments:\n   Users: Include\n   - Security Administrators group\n   - Compliance Administrators group  \n   - Reports Readers group\n   Exclude: Break-glass accounts\n4. Cloud apps or actions: Select apps\n   - Microsoft Azure Management (Azure Portal/Azure Monitor)\n   - Office 365 (for Purview compliance portal)\n   - Microsoft Admin Portals\n5. Configure Conditions:\n   - Sign-in risk: High, Medium\n   - Device platforms: All\n   - Locations: Any location\n6. Access controls - Grant:\n   - Require multifactor authentication (checked)\n   - Require device to be marked as compliant (checked)\n   - Require all selected controls\n7. Session:\n   - Sign-in frequency: Every time\n   - Persistent browser session: Never persistent\n8. Enable policy and test with test user\n9. Monitor policy effectiveness: Sign-ins > Conditional Access\n10. Document policy in security procedures",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-cloud-apps",
      "controlMappings": [
        {
          "controlId": "03.03.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Conditional Access policy requiring MFA and compliant devices provides defense-in-depth protection for audit information access. This ensures that even if credentials for privileged audit roles are compromised, attackers cannot access audit logs without also having the user's MFA device and a compliant corporate device.",
          "nistRequirement": "Protect audit information from unauthorized access"
        }
      ]
    }
  ]
}
