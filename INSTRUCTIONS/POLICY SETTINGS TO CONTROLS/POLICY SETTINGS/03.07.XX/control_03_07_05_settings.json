{
  "controlId": "03.07.05",
  "controlTitle": "Nonlocal Maintenance",
  "family": "MA",
  "familyName": "Maintenance",
  "totalSettings": 6,
  "settings": [
    {
      "id": "AZ-MA-006",
      "settingName": "RequireMFAPrivilegedRoles",
      "displayName": "MFA Required for Privileged Roles (Conditional Access)",
      "settingPath": "conditionalAccess.policies.requireMFAforPrivilegedRoles",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "state": "enabled",
        "grantControls": {
          "builtInControls": ["mfa"],
          "operator": "AND"
        }
      },
      "validationOperator": "==",
      "description": "Enforces multi-factor authentication for all privileged administrative roles when establishing remote maintenance sessions. This directly satisfies the NIST requirement for MFA in nonlocal maintenance and diagnostic sessions.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center (entra.microsoft.com)\n2. Navigate to Protection > Conditional Access > Policies\n3. Create new policy: 'Require MFA for Privileged Roles Remote Maintenance'\n4. Configure Assignments:\n   - Users: Include > Select Directory roles:\n     * Global Administrator\n     * Privileged Role Administrator\n     * Security Administrator\n     * Exchange Administrator\n     * SharePoint Administrator\n     * Intune Administrator\n   - Exclude emergency access accounts\n5. Cloud apps: All cloud apps\n6. Access controls > Grant:\n   - Require multi-factor authentication\n7. Enable policy: On\n8. Test with non-production admin account first",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-admin-mfa",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Directly implements the requirement 'b. Implement multi-factor authentication... in the establishment of nonlocal maintenance and diagnostic sessions' for all privileged accounts performing remote maintenance.",
          "nistRequirement": "Implement multi-factor authentication in the establishment of nonlocal maintenance and diagnostic sessions"
        }
      ]
    },
    {
      "id": "AZ-MA-007",
      "settingName": "PhishingResistantMFA",
      "displayName": "Phishing-Resistant MFA for Privileged Roles",
      "settingPath": "conditionalAccess.authenticationStrength.phishingResistant",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "authenticationStrength": "phishingResistant",
        "allowedMethods": ["fido2", "windowsHello", "certificateBasedAuthentication"]
      },
      "validationOperator": "contains",
      "description": "Requires phishing-resistant authentication methods (FIDO2 security keys, Windows Hello for Business, or certificate-based auth) for privileged roles. This provides replay-resistant authentication as required by NIST, preventing session replay attacks during remote maintenance.",
      "implementationGuide": "1. In Microsoft Entra admin center, go to Protection > Authentication methods\n2. Enable phishing-resistant methods:\n   - FIDO2 security keys: Enable for administrators group\n   - Windows Hello for Business: Enable for all users\n   - Certificate-based authentication: Configure if using PKI\n3. Go to Protection > Conditional Access\n4. Create/edit privileged role MFA policy\n5. Under Grant controls > Require authentication strength:\n   - Select 'Phishing-resistant MFA'\n6. Assign to privileged role groups\n7. Provide FIDO2 keys to administrators\n8. Monitor sign-in logs for compliance",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/authentication/concept-authentication-strengths",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Implements replay-resistant authentication requirement by enforcing FIDO2, Windows Hello, or certificate-based authentication which are cryptographically secure against replay attacks.",
          "nistRequirement": "Implement replay resistance in the establishment of nonlocal maintenance and diagnostic sessions"
        }
      ]
    },
    {
      "id": "AZ-MA-008",
      "settingName": "SessionTimeout",
      "displayName": "Browser Session Timeout for Administrative Users",
      "settingPath": "conditionalAccess.sessionControls.signInFrequency",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "value": 3,
        "type": "hours",
        "isEnabled": true,
        "persistentBrowser": "never"
      },
      "validationOperator": "<=",
      "description": "Enforces automatic session termination after 3 hours of activity for privileged administrative accounts performing remote maintenance. Sessions do not persist across browser closures, requiring re-authentication for each new session.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Conditional Access > Policies\n3. Create policy: 'Admin Session Timeout for Remote Maintenance'\n4. Assignments:\n   - Users: Select directory roles (all privileged roles)\n   - Cloud apps: All cloud apps\n   - Conditions > Client apps: Browser\n5. Session controls:\n   - Sign-in frequency: 3 hours\n   - Persistent browser session: Never\n6. Enable policy\n7. Communicate to administrators about re-authentication requirements\n8. CIS Benchmark recommendation: 3 hours or less",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-session-lifetime",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Directly satisfies requirement 'c. Terminate session and network connections when nonlocal maintenance is completed' by enforcing automatic session timeout and preventing persistent sessions.",
          "nistRequirement": "Terminate session and network connections when nonlocal maintenance is completed"
        }
      ]
    },
    {
      "id": "AZ-MA-009",
      "settingName": "AuditNonlocalAccess",
      "displayName": "Audit Remote Privileged Access",
      "settingPath": "auditLogs.signInLogs.privilegedRoleSignIns",
      "policyType": "AzureAD",
      "policySubType": "AuditLogging",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Captures comprehensive sign-in logs for all privileged role authentications, including source IP, location, device, MFA details, and session duration. Essential for monitoring and approving nonlocal maintenance activities.",
      "implementationGuide": "1. Sign in to Azure portal\n2. Navigate to Microsoft Entra ID > Diagnostic settings\n3. Add diagnostic setting named 'Privileged Access Audit'\n4. Log categories:\n   - SignInLogs: Enable\n   - AuditLogs: Enable\n   - RiskyUsers: Enable\n   - UserRiskEvents: Enable\n5. Destination:\n   - Send to Log Analytics workspace (90+ day retention)\n   - Archive to storage account (optional, 1+ year)\n6. Create alert rules for privileged sign-ins from:\n   - Unfamiliar locations\n   - High-risk sign-ins\n   - Failed MFA attempts\n7. Review weekly in Microsoft Entra ID Protection",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Implements monitoring requirement by providing comprehensive audit trail of all nonlocal maintenance sessions, including authentication details, session duration, and access patterns.",
          "nistRequirement": "Approve and monitor nonlocal maintenance and diagnostic activities"
        }
      ]
    },
    {
      "id": "AZ-MA-010",
      "settingName": "RequireCompliantDevice",
      "displayName": "Require Managed Device for Remote Admin Access",
      "settingPath": "conditionalAccess.policies.requireCompliantDevice",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "grantControls": {
          "builtInControls": ["compliantDevice", "domainJoinedDevice"],
          "operator": "OR"
        }
      },
      "validationOperator": "contains",
      "description": "Restricts remote maintenance access to organization-managed and compliant devices only. Prevents privileged access from unmanaged personal devices that may lack security controls or contain malware.",
      "implementationGuide": "1. Ensure device compliance policies are configured in Intune\n2. Sign in to Microsoft Entra admin center\n3. Navigate to Protection > Conditional Access\n4. Create policy: 'Require Managed Device for Admin Access'\n5. Assignments:\n   - Users: Select directory roles (privileged roles)\n   - Cloud apps: All cloud apps\n6. Grant controls:\n   - Require device to be marked as compliant: OR\n   - Require Microsoft Entra hybrid joined device: OR\n   - (Select 'Require one of the selected controls')\n7. Enable policy after testing\n8. CIS Benchmark Level 2 recommendation",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-compliant-device",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Enhances security of nonlocal maintenance sessions by ensuring maintenance is performed only from organization-controlled devices that meet security baselines and have malware protection.",
          "nistRequirement": "Approve and monitor nonlocal maintenance and diagnostic activities"
        }
      ]
    },
    {
      "id": "DF-MA-011",
      "settingName": "RemoteDesktopAuditing",
      "displayName": "Audit Remote Desktop Protocol Connections",
      "settingPath": "windowsSecurityBaseline.auditPolicy.logonLogoff.auditOtherLogonLogoffEvents",
      "policyType": "Defender",
      "policySubType": "AuditPolicy",
      "platform": "Windows",
      "dataType": "string",
      "expectedValue": "Success and Failure",
      "validationOperator": "==",
      "description": "Enables detailed auditing of Remote Desktop Protocol (RDP) and other remote access sessions used for system maintenance. Logs successful and failed remote connection attempts, session duration, and disconnection events.",
      "implementationGuide": "1. Sign in to Microsoft Intune admin center\n2. Navigate to Endpoint Security > Security Baselines\n3. Select 'Security Baseline for Windows 10 and later'\n4. Create/edit profile\n5. Under Audit Policies > Logon/Logoff:\n   - Audit Other Logon/Logoff Events: Success and Failure\n   - Audit Logon: Success and Failure\n   - Audit Logoff: Success\n   - Audit Special Logon: Success and Failure\n6. Under Remote Desktop Services:\n   - Enable RDP event logging\n7. Assign to all Windows servers and administrative workstations\n8. Forward logs to SIEM for centralized monitoring",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-other-logon-logoff-events",
      "controlMappings": [
        {
          "controlId": "03.07.05",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Provides detailed logging for RDP and remote maintenance sessions, enabling monitoring of when sessions are established, maintained, and terminated as required for nonlocal maintenance oversight.",
          "nistRequirement": "Approve and monitor nonlocal maintenance and diagnostic activities; Terminate session and network connections when nonlocal maintenance is completed"
        }
      ]
    }
  ]
}
