{
  "controlId": "03.01.08",
  "controlTitle": "Unsuccessful Logon Attempts",
  "controlFamily": "AC",
  "nistRequirements": {
    "a": "Enforce a limit of [Assignment: organization-defined number] consecutive invalid logon attempts by a user during a [Assignment: organization-defined time period].",
    "b": "Automatically [Selection (one or more): lock the account or node for an [Assignment: organization-defined time period]; lock the account or node until released by an administrator; delay next logon prompt; notify system administrator; take other action] when the maximum number of unsuccessful attempts is exceeded."
  },
  "researchDate": "2024-11-16",
  "totalSettings": 28,
  "settings": [
    {
      "id": "AZ-SMTLOCK-001",
      "settingName": "lockoutThreshold",
      "displayName": "Smart Lockout - Account Lockout Threshold",
      "settingPath": "authenticationMethodConfiguration.passwordProtection.lockoutThreshold",
      "policyType": "AzureAD",
      "policySubType": "PasswordProtection",
      "platform": "All",
      "dataType": "integer",
      "expectedValue": 5,
      "validationOperator": "<=",
      "description": "Number of failed sign-in attempts allowed before account lockout occurs in Azure AD",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Authentication methods > Password protection\n3. Set 'Lockout threshold' to 5 or fewer failed attempts\n4. Click Save\nNote: Requires Azure AD Premium P1 or higher for customization. Default is 10 for Azure Public, 3 for Azure US Government.",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-password-smart-lockout",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Directly enforces maximum failed logon attempts for Azure AD authentication",
          "nistRequirement": "Requirement a: Enforce limit of consecutive invalid logon attempts"
        }
      ]
    },
    {
      "id": "AZ-SMTLOCK-002",
      "settingName": "lockoutDurationInSeconds",
      "displayName": "Smart Lockout - Account Lockout Duration",
      "settingPath": "authenticationMethodConfiguration.passwordProtection.lockoutDurationInSeconds",
      "policyType": "AzureAD",
      "policySubType": "PasswordProtection",
      "platform": "All",
      "dataType": "integer",
      "expectedValue": 60,
      "validationOperator": ">=",
      "description": "Duration in seconds for account lockout after threshold is exceeded. Lockout duration increases with repeated lockouts.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Authentication methods > Password protection\n3. Set 'Lockout duration in seconds' to 60-18000 (1 minute to 5 hours)\n4. Click Save\nDefault is 60 seconds (1 minute). Duration increases automatically after subsequent failed attempts.",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/authentication/howto-password-smart-lockout",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Defines automatic account lockout duration when threshold exceeded",
          "nistRequirement": "Requirement b: Automatically lock account for time period"
        }
      ]
    },
    {
      "id": "IN-WIN-LOCKOUT-001",
      "settingName": "accountLockoutThreshold",
      "displayName": "Windows - Account Lockout Threshold (Local)",
      "settingPath": "settings.accountPolicies.accountLockout.threshold",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "Windows",
      "dataType": "integer",
      "expectedValue": 5,
      "validationOperator": "<=",
      "description": "Number of failed logon attempts before local Windows account locks. Applies to local authentication on Windows devices.",
      "implementationGuide": "METHOD 1 - PowerShell Script:\n1. Navigate to Intune > Devices > Scripts and remediations > Platform scripts\n2. Add new script with:\n   Net Accounts /lockoutthreshold:5\n3. Assign to Windows device groups\n\nMETHOD 2 - Custom OMA-URI (Windows 11 24H2/Server 2025+):\n1. Create Settings Catalog policy\n2. Add Custom OMA-URI:\n   Name: DeviceLockAccountLockoutPolicy\n   OMA-URI: ./Device/Vendor/MSFT/Policy/Config/DeviceLock/AccountLockoutPolicy\n   Data type: String\n   Value: {\"LockoutThreshold\":5,\"LockoutDuration\":15,\"ResetCounter\":15}\n3. Assign to device groups\n\nVerification: Run 'Net Accounts' command on device",
      "microsoftDocUrl": "https://www.anoopcnair.com/best-way-to-set-lockout-policy-using-intune/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Enforces failed logon attempt limit for local Windows authentication",
          "nistRequirement": "Requirement a: Enforce limit of consecutive invalid logon attempts"
        }
      ]
    },
    {
      "id": "IN-WIN-LOCKOUT-002",
      "settingName": "accountLockoutDuration",
      "displayName": "Windows - Account Lockout Duration (Local)",
      "settingPath": "settings.accountPolicies.accountLockout.duration",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "Windows",
      "dataType": "integer",
      "expectedValue": 15,
      "validationOperator": ">=",
      "description": "Duration in minutes for local Windows account lockout. Range: 1-99,999 minutes.",
      "implementationGuide": "METHOD 1 - PowerShell Script:\n1. Navigate to Intune > Devices > Scripts and remediations > Platform scripts\n2. Add new script with:\n   Net Accounts /lockoutduration:15\n3. Assign to Windows device groups\n\nMETHOD 2 - Custom OMA-URI (Windows 11 24H2/Server 2025+):\nIncluded in AccountLockoutPolicy OMA-URI (see IN-WIN-LOCKOUT-001)",
      "microsoftDocUrl": "https://www.anoopcnair.com/windows-11-account-lockout-policy-intune-setup/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Automatically locks account for defined time period after threshold exceeded",
          "nistRequirement": "Requirement b: Lock account for time period"
        }
      ]
    },
    {
      "id": "IN-WIN-LOCKOUT-003",
      "settingName": "accountLockoutResetCounter",
      "displayName": "Windows - Reset Account Lockout Counter After",
      "settingPath": "settings.accountPolicies.accountLockout.resetCounter",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "Windows",
      "dataType": "integer",
      "expectedValue": 15,
      "validationOperator": ">=",
      "description": "Minutes before failed logon counter resets to zero. Must be less than or equal to lockout duration. Range: 1-99,999 minutes.",
      "implementationGuide": "METHOD 1 - PowerShell Script:\n1. Navigate to Intune > Devices > Scripts and remediations > Platform scripts\n2. Add new script with:\n   Net Accounts /lockoutwindow:15\n3. Assign to Windows device groups\n\nMETHOD 2 - Custom OMA-URI (Windows 11 24H2/Server 2025+):\nIncluded in AccountLockoutPolicy OMA-URI (see IN-WIN-LOCKOUT-001)",
      "microsoftDocUrl": "https://www.anoopcnair.com/windows-11-account-lockout-policy-intune-setup/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Defines observation window for counting failed logon attempts",
          "nistRequirement": "Requirement a: During organization-defined time period"
        }
      ]
    },
    {
      "id": "IN-WIN-LOCKOUT-004",
      "settingName": "allowAdministratorLockout",
      "displayName": "Windows - Allow Administrator Account Lockout",
      "settingPath": "deviceLock.allowAdministratorLockout",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "Windows",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Allows lockout policy to apply to built-in Administrator account (Windows 11 23H2+)",
      "implementationGuide": "1. Navigate to Intune > Devices > Configuration profiles\n2. Create Settings Catalog policy\n3. Search for 'Device Lock'\n4. Add setting: Allow administrator account lockout\n5. Configure Custom OMA-URI:\n   Name: Allow administrator account lockout\n   OMA-URI: ./Device/Vendor/MSFT/Policy/Config/DeviceLock/AllowAdministratorLockout\n   Data type: Integer\n   Value: 1\n6. Assign to Windows device groups",
      "microsoftDocUrl": "https://www.onevinn.com/blog/windows-11-local-account-lockout-policy",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Ensures lockout policy applies to privileged local administrator account",
          "nistRequirement": "Requirement a: Enforce limit for all user accounts including privileged"
        }
      ]
    },
    {
      "id": "IN-WIN-WIPE-001",
      "settingName": "maxDevicePasswordFailedAttempts",
      "displayName": "Windows - Maximum Sign-In Failures Before Wiping Device",
      "settingPath": "deviceLock.maxDevicePasswordFailedAttempts",
      "policyType": "Intune",
      "policySubType": "SecurityBaseline",
      "platform": "Windows",
      "dataType": "integer",
      "expectedValue": 10,
      "validationOperator": "<=",
      "description": "Number of authentication failures before device enters BitLocker recovery (functional wipe). 0 disables wipe functionality.",
      "implementationGuide": "1. Navigate to Intune > Endpoint security > Security baselines\n2. Select 'Security Baseline for Windows 10 and later'\n3. Create profile > Device Lock section\n4. Configure 'Number of sign-in failures before wiping device' to 10 or fewer\n5. Assign to Windows device groups\n\nNote: Device reboots into BitLocker recovery wizard, effectively locking device until recovery key provided.",
      "microsoftDocUrl": "https://inthecloud247.com/automatically-wipe-a-windows-10-device-after-a-number-of-authentication-failures/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Additional layer protecting device from extended brute force attacks by triggering BitLocker recovery",
          "nistRequirement": "Requirement b: Take other action when maximum attempts exceeded"
        }
      ]
    },
    {
      "id": "IN-IOS-WIPE-001",
      "settingName": "maxInactivityTimeDeviceLockWithPasscode",
      "displayName": "iOS/iPadOS - Number of Sign-In Failures Before Wiping Device",
      "settingPath": "restrictedApps.maxInactivityTimeDeviceLockWithPasscode",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "iOS",
      "dataType": "integer",
      "expectedValue": 10,
      "validationOperator": "<=",
      "description": "Number of failed sign-in attempts before iOS/iPadOS device is wiped. Range: 2-11. Recommended: 4-10.",
      "implementationGuide": "1. Navigate to Intune > Devices > Configuration profiles > Create profile\n2. Platform: iOS/iPadOS\n3. Profile type: Device restrictions\n4. Password section\n5. Configure 'Number of sign-in failures before wiping device' to 4-10\n6. Assign to iOS/iPadOS device groups\n\nNote: Not recommended to set to 2-3 (too sensitive). iOS has built-in delays for failed attempts.",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/intune/intune-service/configuration/device-restrictions-ios",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Enforces device wipe after maximum failed authentication attempts on iOS/iPadOS",
          "nistRequirement": "Requirement b: Take action (wipe device) when maximum attempts exceeded"
        }
      ]
    },
    {
      "id": "IN-AND-WIPE-001",
      "settingName": "passwordFailureCountBeforeWipe",
      "displayName": "Android - Password Failure Count Before Device Wipe",
      "settingPath": "androidDeviceOwner.passwordFailureCountBeforeWipe",
      "policyType": "Intune",
      "policySubType": "DeviceConfiguration",
      "platform": "Android",
      "dataType": "integer",
      "expectedValue": 10,
      "validationOperator": "<=",
      "description": "Number of wrong password attempts before device is wiped. Range: 4-11. Personal work profile: removes work profile. Corporate devices: wipes device.",
      "implementationGuide": "1. Navigate to Intune > Devices > Configuration profiles > Create profile\n2. Platform: Android Enterprise\n3. Profile type: Device restrictions\n4. Password section\n5. Configure 'Number of passwords required before user can reuse password' to 4-11\n6. Assign to Android device groups\n\nNote: Behavior differs by enrollment type:\n- Personal work profile: Work profile removed, personal data intact\n- Corporate devices: Full device wipe",
      "microsoftDocUrl": "https://www.anoopcnair.com/enforce-screen-lock-for-android-devices-intune/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Enforces device/work profile wipe after maximum failed authentication attempts on Android",
          "nistRequirement": "Requirement b: Take action (wipe) when maximum attempts exceeded"
        }
      ]
    },
    {
      "id": "AZ-IDPROT-001",
      "settingName": "signInRiskPolicy",
      "displayName": "Sign-In Risk Policy - Require MFA on Medium/High Risk",
      "settingPath": "identityProtection.riskPolicies.signInRisk",
      "policyType": "AzureAD",
      "policySubType": "IdentityProtection",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "state": "enabled",
        "riskLevel": ["medium", "high"],
        "controls": ["mfa"]
      },
      "validationOperator": "==",
      "description": "Requires MFA when sign-in risk is medium or high. Risk detection includes unfamiliar sign-in properties, malicious IP addresses, atypical travel, etc.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Conditional Access\n3. Create new policy: 'Sign-In Risk - Require MFA'\n4. Under Conditions > Sign-in risk: Select Medium and High\n5. Under Access controls > Grant: Require multifactor authentication\n6. Enable policy\n7. Exclude emergency access accounts\n\nRequires: Azure AD Premium P2",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/azure/active-directory/authentication/tutorial-risk-based-sspr-mfa",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Automatically challenges suspicious sign-in attempts with additional authentication, preventing unauthorized access",
          "nistRequirement": "Requirement b: Take other action (require MFA) for suspicious attempts"
        }
      ]
    },
    {
      "id": "AZ-IDPROT-002",
      "settingName": "userRiskPolicy",
      "displayName": "User Risk Policy - Require Password Change on High Risk",
      "settingPath": "identityProtection.riskPolicies.userRisk",
      "policyType": "AzureAD",
      "policySubType": "IdentityProtection",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "state": "enabled",
        "riskLevel": ["high"],
        "controls": ["passwordChange", "mfa"]
      },
      "validationOperator": "==",
      "description": "Requires secure password reset when user risk is high. Detects leaked credentials, impossible travel, and compromised accounts.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Conditional Access\n3. Create new policy: 'User Risk - Require Password Change'\n4. Under Conditions > User risk: Select High\n5. Under Access controls > Grant: Require password change\n6. Require MFA before password change\n7. Enable policy\n8. Exclude emergency access accounts\n\nRequires: Azure AD Premium P2",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/azure/active-directory/authentication/tutorial-risk-based-sspr-mfa",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Automatically secures compromised accounts by forcing password change, preventing attacker from continued failed attempts",
          "nistRequirement": "Requirement b: Take other action (secure password reset) for compromised accounts"
        }
      ]
    },
    {
      "id": "AZ-IDPROT-003",
      "settingName": "riskySignInsReport",
      "displayName": "Risky Sign-Ins Monitoring Report",
      "settingPath": "identityProtection.reports.riskySignIns",
      "policyType": "AzureAD",
      "policySubType": "IdentityProtection",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Monitors and reports sign-in attempts with detected risk. Includes failed attempts from malicious IPs, unfamiliar locations, and brute force attacks.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Identity Protection > Risky sign-ins\n3. Review sign-ins flagged as risky\n4. Configure alerts: Protection > Identity Protection > Notify\n5. Set up weekly digest emails\n6. Configure alerts for high-risk users\n\nAccess via Microsoft Graph:\nGET https://graph.microsoft.com/v1.0/identityProtection/riskySignIns\n\nRequires: Azure AD Premium P2 for full features",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-remediate-unblock",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Provides visibility into unsuccessful and suspicious authentication attempts for security monitoring",
          "nistRequirement": "Requirement b: Notify system administrator of failed attempts"
        }
      ]
    },
    {
      "id": "AZ-AUDIT-001",
      "settingName": "signInLogsEnabled",
      "displayName": "Azure AD Sign-In Logs - Enabled",
      "settingPath": "monitoring.signInLogs.enabled",
      "policyType": "AzureAD",
      "policySubType": "DiagnosticSettings",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Enables logging of all sign-in attempts including failed authentications. Captures IP address, location, device, application, and failure reason.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Monitoring & health > Sign-in logs\n3. Verify sign-in logs are capturing data\n4. For extended retention: Navigate to Monitoring & health > Diagnostic settings\n5. Add diagnostic setting\n6. Select 'SignInLogs'\n7. Configure destination: Log Analytics workspace, Storage account, or Event Hub\n8. Save\n\nDefault retention: 30 days (Azure AD Premium), 7 days (Free)\nExtended retention requires Azure Monitor",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/concept-sign-ins",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Logs all authentication attempts including failures for audit and investigation",
          "nistRequirement": "Requirement b: Monitoring and logging of failed logon attempts"
        }
      ]
    },
    {
      "id": "AZ-AUDIT-002",
      "settingName": "signInLogsRetention",
      "displayName": "Azure AD Sign-In Logs - Extended Retention",
      "settingPath": "monitoring.signInLogs.retentionDays",
      "policyType": "AzureAD",
      "policySubType": "DiagnosticSettings",
      "platform": "All",
      "dataType": "integer",
      "expectedValue": 365,
      "validationOperator": ">=",
      "description": "Extends sign-in log retention beyond default 30 days for compliance and investigation. Requires Azure Monitor.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Monitoring & health > Diagnostic settings\n3. Add diagnostic setting\n4. Select 'SignInLogs'\n5. Configure destination: Log Analytics workspace with 365+ day retention\n   OR Storage account for archive\n6. Set retention period in destination:\n   - Log Analytics: Set retention to 365+ days\n   - Storage: Configure archive policy\n7. Save\n\nRequires: Azure subscription, Log Analytics workspace or Storage account",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/monitoring-health/howto-integrate-activity-logs-with-azure-monitor-logs",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Provides extended audit trail of failed authentication attempts for compliance and forensic analysis",
          "nistRequirement": "Supporting capability for logging unsuccessful attempts"
        }
      ]
    },
    {
      "id": "PV-AUDIT-001",
      "settingName": "unifiedAuditLogEnabled",
      "displayName": "Microsoft 365 Unified Audit Log - Enabled",
      "settingPath": "compliance.auditLog.unifiedAuditLogIngestionEnabled",
      "policyType": "Purview",
      "policySubType": "AuditLog",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Enables unified audit logging for Microsoft 365, including user authentication events and failed logon attempts.",
      "implementationGuide": "1. Sign in to Microsoft Purview compliance portal (https://compliance.microsoft.com)\n2. Navigate to Audit\n3. Click 'Start recording user and admin activities'\n4. Verify auditing is enabled\n\nPowerShell verification:\nConnect-ExchangeOnline\nGet-AdminAuditLogConfig | Format-List UnifiedAuditLogIngestionEnabled\n\nTo enable via PowerShell:\nSet-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true\n\nNote: Can take up to 24 hours for audit events to appear after enabling",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/purview/audit-log-enable-disable",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Logs authentication events across Microsoft 365 services including failed attempts",
          "nistRequirement": "Supporting capability for comprehensive authentication logging"
        }
      ]
    },
    {
      "id": "PV-AUDIT-002",
      "settingName": "auditLogRetentionPolicy",
      "displayName": "Audit Log Retention Policy - 1 Year",
      "settingPath": "compliance.auditLog.retentionPolicies",
      "policyType": "Purview",
      "policySubType": "AuditLog",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "retentionDuration": "365",
        "recordTypes": ["AzureActiveDirectory", "AzureActiveDirectoryAccountLogon"]
      },
      "validationOperator": ">=",
      "description": "Extends audit log retention for Azure AD authentication events to 365 days minimum. Default is 90 days (E3) or 365 days (E5).",
      "implementationGuide": "1. Sign in to Microsoft Purview compliance portal\n2. Navigate to Audit > Retention policies\n3. Create new audit log retention policy\n4. Name: 'Authentication Events - 1 Year Retention'\n5. Record types: Select 'Azure Active Directory logon events'\n6. Duration: 365 days (or longer)\n7. Priority: Set appropriately\n8. Save policy\n\nNote: Requires Microsoft 365 E5 or E5 Compliance add-on",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/purview/audit-log-retention-policies",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Ensures long-term retention of failed authentication attempt records for compliance and investigation",
          "nistRequirement": "Supporting capability for audit trail of unsuccessful attempts"
        }
      ]
    },
    {
      "id": "AZ-CA-001",
      "settingName": "conditionalAccessBlockLegacyAuth",
      "displayName": "Conditional Access - Block Legacy Authentication",
      "settingPath": "conditionalAccess.policies.blockLegacyAuth",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "state": "enabled",
        "clientApps": ["exchangeActiveSync", "other"],
        "grantControls": "block"
      },
      "validationOperator": "==",
      "description": "Blocks legacy authentication protocols that don't support modern security like MFA, preventing brute force attacks via legacy protocols.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Conditional Access\n3. Create new policy: 'Block Legacy Authentication'\n4. Users: All users (exclude emergency accounts)\n5. Cloud apps: All cloud apps\n6. Conditions > Client apps:\n   - Exchange ActiveSync clients\n   - Other clients (legacy protocols)\n7. Access controls: Block\n8. Enable policy\n\nNote: Test in report-only mode first. Requires Azure AD Premium P1",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/block-legacy-authentication",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Prevents brute force attacks via legacy authentication protocols that bypass modern lockout protections",
          "nistRequirement": "Requirement b: Take action (block) to prevent continued failed attempts via unsecured protocols"
        }
      ]
    },
    {
      "id": "AZ-CA-002",
      "settingName": "conditionalAccessBlockUnknownPlatforms",
      "displayName": "Conditional Access - Block Unknown Device Platforms",
      "settingPath": "conditionalAccess.policies.blockUnknownPlatforms",
      "policyType": "AzureAD",
      "policySubType": "ConditionalAccess",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "state": "enabled",
        "platforms": ["unknown"],
        "grantControls": "block"
      },
      "validationOperator": "==",
      "description": "Blocks authentication attempts from unknown or unmanaged device platforms, reducing attack surface for brute force attempts.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Conditional Access\n3. Create new policy: 'Block Unknown Platforms'\n4. Users: All users (exclude emergency accounts)\n5. Cloud apps: All cloud apps\n6. Conditions > Device platforms: Select 'Unknown'\n7. Access controls: Block\n8. Enable policy\n\nNote: Test thoroughly as this may impact legitimate users",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-conditions#device-platforms",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Reduces attack surface by blocking authentication from unrecognized platforms used in automated attacks",
          "nistRequirement": "Requirement b: Take other action (block unrecognized sources)"
        }
      ]
    },
    {
      "id": "AZ-ALERT-001",
      "settingName": "idProtectionAlerts",
      "displayName": "Identity Protection - High Risk User Alerts",
      "settingPath": "identityProtection.notifications.usersAtRisk",
      "policyType": "AzureAD",
      "policySubType": "IdentityProtection",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "enabled": true,
        "riskLevel": "high",
        "recipients": ["security-team@organization.com"]
      },
      "validationOperator": "==",
      "description": "Sends email alerts to administrators when users are flagged as high risk due to suspicious sign-in patterns including failed attempts.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Identity Protection > Notify\n3. Configure 'Users at risk detected alerts':\n   - Enable alerts\n   - Risk level: High\n   - Recipients: Add security team email addresses\n4. Save\n\nAlert triggers include:\n- Multiple failed sign-ins from malicious IPs\n- Leaked credentials\n- Impossible travel\n- Unfamiliar sign-in properties",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-configure-notifications",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Notifies system administrators of suspicious failed authentication attempts for immediate response",
          "nistRequirement": "Requirement b: Notify system administrator when maximum attempts exceeded"
        }
      ]
    },
    {
      "id": "AZ-ALERT-002",
      "settingName": "idProtectionWeeklyDigest",
      "displayName": "Identity Protection - Weekly Digest Email",
      "settingPath": "identityProtection.notifications.weeklyDigest",
      "policyType": "AzureAD",
      "policySubType": "IdentityProtection",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "enabled": true,
        "recipients": ["security-team@organization.com"]
      },
      "validationOperator": "==",
      "description": "Sends weekly summary of risky users and sign-ins including failed authentication patterns.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Protection > Identity Protection > Notify\n3. Configure 'Weekly digest':\n   - Enable weekly digest\n   - Recipients: Add security team email addresses\n4. Save\n\nDigest includes:\n- New risky users detected\n- Risky sign-ins summary\n- Users with resolved risks\n- Overall security posture",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-configure-notifications",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Provides regular summaries of authentication security including failed attempt patterns",
          "nistRequirement": "Supporting notification capability for failed attempt monitoring"
        }
      ]
    },
    {
      "id": "AZ-MONITOR-001",
      "settingName": "failedSignInAlert",
      "displayName": "Azure Monitor - Failed Sign-In Alert Rule",
      "settingPath": "azureMonitor.alerts.failedSignIns",
      "policyType": "AzureAD",
      "policySubType": "AzureMonitor",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "enabled": true,
        "threshold": 5,
        "timeWindow": "5 minutes",
        "severity": "High"
      },
      "validationOperator": "==",
      "description": "Creates alert when user has 5+ failed sign-in attempts within 5-minute window, indicating potential brute force attack.",
      "implementationGuide": "1. Sign in to Azure portal\n2. Navigate to Monitor > Alerts > Alert rules\n3. Create alert rule\n4. Scope: Select Log Analytics workspace with Azure AD logs\n5. Condition: Custom log search\n   Query: SigninLogs | where ResultType != 0 | summarize FailedAttempts = count() by UserPrincipalName | where FailedAttempts >= 5\n6. Actions: Create action group to notify security team\n7. Alert rule details:\n   - Name: 'Multiple Failed Sign-Ins Detected'\n   - Severity: High\n   - Evaluation frequency: 5 minutes\n8. Create alert rule\n\nRequires: Log Analytics workspace, Azure Monitor Logs",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-create-log-alert-rule",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": true,
          "mappingRationale": "Provides real-time alerting on patterns of failed authentication attempts indicating attacks",
          "nistRequirement": "Requirement b: Notify system administrator of failed attempts"
        }
      ]
    },
    {
      "id": "DEF-001",
      "settingName": "defenderIdentityAlerts",
      "displayName": "Defender for Identity - Brute Force Attack Alerts",
      "settingPath": "defenderForIdentity.alerts.bruteForce",
      "policyType": "Defender",
      "policySubType": "DefenderForIdentity",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Detects and alerts on brute force authentication attacks including password spray and failed logon attempts.",
      "implementationGuide": "1. Defender for Identity must be deployed\n2. Sign in to Microsoft 365 Defender portal (https://security.microsoft.com)\n3. Navigate to Settings > Identities\n4. Verify sensors are deployed and healthy\n5. Navigate to Incidents & alerts > Alert policies\n6. Verify 'Brute force attack' alert is enabled\n7. Configure notification recipients\n\nDefender for Identity automatically detects:\n- Suspected brute force attacks (Kerberos, NTLM)\n- Password spray attacks\n- Unusual failed authentication patterns\n\nRequires: Microsoft Defender for Identity license",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/defender-for-identity/alerts-overview",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Advanced detection of sophisticated brute force attacks and password spray attempts",
          "nistRequirement": "Requirement b: Notify administrator and take action on detected attack patterns"
        }
      ]
    },
    {
      "id": "GRAPH-001",
      "settingName": "signInActivityQuery",
      "displayName": "Microsoft Graph - Sign-In Activity Query",
      "settingPath": "graph.signIns",
      "policyType": "AzureAD",
      "policySubType": "MicrosoftGraph",
      "platform": "All",
      "dataType": "api",
      "expectedValue": "accessible",
      "validationOperator": "==",
      "description": "Microsoft Graph API endpoint for programmatically querying sign-in logs including failed attempts.",
      "implementationGuide": "API Endpoint: GET https://graph.microsoft.com/v1.0/auditLogs/signIns\n\nRequired Permissions:\n- AuditLog.Read.All (Application)\n- Directory.Read.All (Application)\n\nQuery for failed sign-ins:\nGET https://graph.microsoft.com/v1.0/auditLogs/signIns?$filter=status/errorCode ne 0\n\nQuery for specific user:\nGET https://graph.microsoft.com/v1.0/auditLogs/signIns?$filter=userPrincipalName eq 'user@domain.com' and status/errorCode ne 0\n\nQuery for time range:\nGET https://graph.microsoft.com/v1.0/auditLogs/signIns?$filter=createdDateTime ge 2024-11-01 and status/errorCode ne 0\n\nResponse includes:\n- UserPrincipalName\n- Status (error code)\n- IPAddress\n- Location\n- DeviceDetail\n- ConditionalAccessStatus",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/graph/api/signin-list",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Enables programmatic access to failed authentication logs for automated monitoring and compliance reporting",
          "nistRequirement": "Supporting capability for monitoring and reporting failed attempts"
        }
      ]
    },
    {
      "id": "PS-001",
      "settingName": "searchUnifiedAuditLog",
      "displayName": "PowerShell - Search Unified Audit Log for Failed Sign-Ins",
      "settingPath": "powershell.exchangeOnline.searchUnifiedAuditLog",
      "policyType": "Purview",
      "policySubType": "PowerShell",
      "platform": "All",
      "dataType": "cmdlet",
      "expectedValue": "available",
      "validationOperator": "==",
      "description": "PowerShell cmdlet to search unified audit log for failed authentication attempts.",
      "implementationGuide": "Prerequisites:\n1. Connect to Exchange Online PowerShell:\n   Connect-ExchangeOnline\n\nSearch for failed sign-ins:\nSearch-UnifiedAuditLog -StartDate (Get-Date).AddDays(-7) -EndDate (Get-Date) -Operations UserLoginFailed -ResultSize 5000\n\nSearch for specific user:\nSearch-UnifiedAuditLog -StartDate (Get-Date).AddDays(-7) -EndDate (Get-Date) -UserIds user@domain.com -Operations UserLoginFailed\n\nExport results:\nSearch-UnifiedAuditLog -StartDate (Get-Date).AddDays(-30) -EndDate (Get-Date) -Operations UserLoginFailed -ResultSize 5000 | Export-Csv -Path 'C:\\FailedSignIns.csv' -NoTypeInformation\n\nNote: Maximum 5000 results per query. Use pagination for larger datasets.",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/powershell/module/exchange/search-unifiedauditlog",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Provides PowerShell-based access to failed authentication logs for scripting and automation",
          "nistRequirement": "Supporting capability for querying and analyzing failed attempts"
        }
      ]
    },
    {
      "id": "PS-002",
      "settingName": "getAzureADAuditSignInLogs",
      "displayName": "PowerShell - Get Azure AD Sign-In Logs",
      "settingPath": "powershell.azureAD.getAzureADAuditSignInLogs",
      "policyType": "AzureAD",
      "policySubType": "PowerShell",
      "platform": "All",
      "dataType": "cmdlet",
      "expectedValue": "available",
      "validationOperator": "==",
      "description": "PowerShell cmdlet to retrieve Azure AD sign-in audit logs including failed attempts.",
      "implementationGuide": "Prerequisites:\n1. Install Microsoft Graph PowerShell SDK:\n   Install-Module Microsoft.Graph -Scope CurrentUser\n2. Connect to Microsoft Graph:\n   Connect-MgGraph -Scopes 'AuditLog.Read.All', 'Directory.Read.All'\n\nGet failed sign-ins (last 7 days):\nGet-MgAuditLogSignIn -Filter \"status/errorCode ne 0 and createdDateTime ge $(Get-Date).AddDays(-7).ToString('yyyy-MM-ddTHH:mm:ssZ')\" -Top 100\n\nGet failed sign-ins for specific user:\nGet-MgAuditLogSignIn -Filter \"userPrincipalName eq 'user@domain.com' and status/errorCode ne 0\" -Top 100\n\nExport to CSV:\nGet-MgAuditLogSignIn -Filter \"status/errorCode ne 0\" -Top 1000 | Select-Object UserPrincipalName, CreatedDateTime, IPAddress, Status, Location | Export-Csv -Path 'FailedSignIns.csv' -NoTypeInformation",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.reports/get-mgauditlogsignin",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Provides direct PowerShell access to Azure AD sign-in logs for failed attempt analysis",
          "nistRequirement": "Supporting capability for retrieving and analyzing failed attempts"
        }
      ]
    },
    {
      "id": "SENTINEL-001",
      "settingName": "sentinelFailedSignInWorkbook",
      "displayName": "Microsoft Sentinel - Failed Sign-In Analysis Workbook",
      "settingPath": "sentinel.workbooks.failedSignIns",
      "policyType": "AzureAD",
      "policySubType": "Sentinel",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Sentinel workbook for visualizing and analyzing failed sign-in patterns, brute force attempts, and account lockouts.",
      "implementationGuide": "Prerequisites:\n1. Microsoft Sentinel workspace deployed\n2. Azure AD logs connected to Sentinel:\n   - Navigate to Sentinel > Data connectors\n   - Connect 'Azure Active Directory' connector\n   - Enable sign-in logs\n\nCreate workbook:\n1. Navigate to Microsoft Sentinel > Workbooks\n2. Add workbook\n3. Use template: 'Sign-in failure analysis'\n   OR create custom workbook with KQL queries:\n\nFailed sign-ins by user:\nSigninLogs\n| where ResultType != 0\n| summarize FailedAttempts = count() by UserPrincipalName\n| order by FailedAttempts desc\n\nFailed sign-ins by error code:\nSigninLogs\n| where ResultType != 0\n| summarize Count = count() by ResultType, ResultDescription\n| order by Count desc\n\nBrute force detection:\nSigninLogs\n| where ResultType != 0\n| summarize FailedAttempts = count() by UserPrincipalName, IPAddress, bin(TimeGenerated, 5m)\n| where FailedAttempts >= 5",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/azure/sentinel/monitor-audit-sign-in-logs",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Provides advanced analytics and visualization of failed authentication patterns for security operations",
          "nistRequirement": "Supporting capability for analyzing and investigating failed attempts"
        }
      ]
    },
    {
      "id": "COMP-001",
      "settingName": "deviceCompliancePasswordPolicy",
      "displayName": "Device Compliance - Password Policy with Lockout",
      "settingPath": "compliance.deviceCompliance.passwordPolicy",
      "policyType": "Intune",
      "policySubType": "CompliancePolicy",
      "platform": "All",
      "dataType": "object",
      "expectedValue": {
        "requirePassword": true,
        "minimumPasswordLength": 8,
        "passwordComplexity": "required",
        "enforceAccountLockout": true
      },
      "validationOperator": "==",
      "description": "Device compliance policy requiring password with account lockout enforcement. Devices not meeting requirements are marked non-compliant.",
      "implementationGuide": "1. Navigate to Intune > Devices > Compliance policies\n2. Create policy for each platform (Windows, iOS, Android)\n3. Configure Password section:\n   - Require a password: Yes\n   - Minimum password length: 8+\n   - Password complexity: Required\n4. Combine with Conditional Access to block non-compliant devices\n5. Assign to device groups\n\nNote: Enforces that devices have lockout policies configured, but doesn't set specific threshold values (use device configuration for that).",
      "microsoftDocUrl": "https://learn.microsoft.com/en-us/intune/intune-service/protect/device-compliance-get-started",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "Medium",
          "isRequired": false,
          "mappingRationale": "Ensures devices accessing resources have account lockout protections in place",
          "nistRequirement": "Supporting requirement to enforce lockout policies on managed devices"
        }
      ]
    },
    {
      "id": "ENTRA-WORKBOOK-001",
      "settingName": "entraSignInFailureWorkbook",
      "displayName": "Entra Workbook - Sign-In Failure Analysis",
      "settingPath": "entra.workbooks.signInFailureAnalysis",
      "policyType": "AzureAD",
      "policySubType": "EntraWorkbook",
      "platform": "All",
      "dataType": "boolean",
      "expectedValue": true,
      "validationOperator": "==",
      "description": "Built-in Entra workbook for analyzing sign-in failures, identifying patterns, and diagnosing authentication issues.",
      "implementationGuide": "1. Sign in to Microsoft Entra admin center\n2. Navigate to Monitoring & health > Workbooks\n3. Select 'Sign-in failure analysis' template\n4. View available analytics:\n   - Failed sign-ins by user\n   - Failed sign-ins by error code\n   - Failed sign-ins by application\n   - Failed sign-ins by location\n   - Temporal analysis of failures\n5. Customize time range and filters\n6. Save workbook for recurring use\n\nCustom KQL queries available for:\n- Identifying brute force patterns\n- Analyzing locked accounts\n- Tracking repeat offenders\n- Geographic anomaly detection",
      "microsoftDocUrl": "https://blog.admindroid.com/audit-sign-in-failures-in-microsoft-365-with-workbook/",
      "controlMappings": [
        {
          "controlId": "03.01.08",
          "confidence": "High",
          "isRequired": false,
          "mappingRationale": "Provides interactive visual analysis of failed authentication attempts for investigation",
          "nistRequirement": "Supporting capability for analyzing patterns in failed attempts"
        }
      ]
    }
  ]
}
